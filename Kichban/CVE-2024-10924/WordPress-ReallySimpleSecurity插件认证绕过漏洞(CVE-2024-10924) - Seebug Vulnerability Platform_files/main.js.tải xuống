function csrfSafeMethod(a) {
    return /^(GET|HEAD|OPTIONS|TRACE)$/.test(a)
}
var SB = {};
SB.VUL_CATEGORYS = ["All", "HTTP 参数污染", "后门", "Cookie 验证错误", "跨站请求伪造", "ShellCode", "SQL 注入", "任意文件下载", "任意文件创建", "任意文件删除", "任意文件读取", "其他类型", "变量覆盖", "命令执行", "嵌入恶意代码", "弱密码", "拒绝服务", "数据库发现", "文件上传", "远程文件包含", "本地溢出", "权限提升", "信息泄漏", "登录绕过", "目录穿越", "解析错误", "越权访问", "跨站脚本", "路径泄漏", "代码执行", "远程密码修改", "远程溢出", "目录遍历", "空字节注入", "中间人攻击", "格式化字符串", "缓冲区溢出", "HTTP 请求拆分", "CRLF 注入", "XML 注入", "本地文件包含", "证书预测", "HTTP 响应拆分", "SSI 注入", "内存溢出", "整数溢出", "HTTP 响应伪造", "HTTP 请求伪造", "内容欺骗", "XQuery 注入", "缓存区过读", "暴力破解", "LDAP 注入", "安全模式绕过", "备份文件发现", "XPath 注入", "URL 重定向", "代码泄漏", "释放后重用", "DNS 劫持", "错误的输入验证"], SB.API = {
    updateProfile: function (a) {
        var b = "/accounts/detail";
        return $.post(b, a)
    }, updatePassword: function (a) {
        var b = "/accounts/modifypassword";
        return $.post(b, a)
    }, sendActiveEmail: function (a) {
        var b = "confirm/send";
        return $.post(b, a)
    }, exchangePrize: function (a) {
        $.ajax({
            url: "/exchange/goods/exchange",
            type: "post",
            dataType: "json",
            data: a
        })
    }, getCaptcha: function () {
        var a = $("#J-captcha-key"), b = $("#J-captcha");
        return a.size() && b.size() ? void $.ajax({
            url: "/utils/captcha",
            type: "get",
            dataType: "json",
            success: function (a) {
                a.status ? ($("#J-captcha-key").val(a.data.new_cptch_key), $("#J-captcha").attr("src", a.data.new_cptch_image)) : SB.showMessage(a.message ? a.message : "系统繁忙，请稍后重试", "error")
            }
        }) : !1
    }, contribute: function (a) {
        var b = "/contribute/submitVul/";
        return $.post(b, a)
    }, nuwa: function (a) {
        var b = "/nuwa/";
        return $.post(b, a)
    }, contributeField: function (a) {
        return $.ajax({
            url: "/vuldb/addDesc/" + a.vulId,
            type: "post",
            dataType: "json",
            data: JSON.stringify(a)
        })
    }, editContribute: function (a) {
        var b = "/contribute/edit";
        return $.post(b, a)
    }, followVul: function (a) {
        return $.ajax({
            url: "/vuldb/follow/" + a.vulId,
            type: "post",
            dataType: "json",
            data: JSON.stringify({follow: !a.hasFollow})
        })
    }, likeVul: function (a) {
        return $.ajax({
            url: "/vuldb/praise/" + a.vulId,
            type: "post",
            dataType: "json"
        })
    }, comment: function (a) {
        var b = a.comment_id ? "reply" : "comment";
        a.title = document.title;
        return $.ajax({
            url: "/vuldb/" + b + "/" + a.vulId,
            type: "post",
            dataType: "json",
            data: JSON.stringify(a)
        })
    }, weiboCheckBind: function () {
        return $.ajax({
            url: "/plugin/weibo/check-bind?url=" + window.location.href,
            type: "get",
        })
    }, likeComment: function (a) {
        return $.ajax({
            url: "/vuldb/vote/" + a.commentId,
            type: "post",
            dataType: "json",
            data: JSON.stringify({type: a.type, status: a.status})
        })
    }, exchangeVul: function (a) {
        return $.ajax({
            url: "/vuldb/exchange/" + a.vulId,
            type: "post",
            dataType: "json",
            data: JSON.stringify(a.postContent)
        })
    }, followUser: function (a) {
        var b = "/accounts/follow_user";
        return $.post(b, a)
    }, checkVul: function (a, b, c, d, e) {
        $.ajax({
            url: "/monster/check",
            type: "post",
            dataType: "json",
            data: JSON.stringify(a),
            beforeSend: b,
            success: c,
            error: d,
            complete: e
        })
    }
}, SB.UTIL = {
    prepareReplyForm: function (a) {
        var b = '    <form class="reply-form" action="" data-vul-id={{vulId}} data-comment-id="{{commentId}}">      <textarea name="" id="" cols="30" rows="10" class="comment_input"></textarea>      <div class="clearfix">        <div class="pull-left">          <div class="checkbox"><label><input class="is-anonymous" type="checkbox"> 匿名回复</label>{{#if isWeiboBind}}<label style="margin-left: 10px"><input class="is-weibo-bind" type="checkbox">同步到微博</label>{{/if}}</div>        </div>        <div class="pull-right" style="margin-top: 10px;">          <button class="btn btn-brand-fill btn-submit-reply" type="button">回复</button>          <button class="btn btn-brand-fill btn-cancel-reply" type="button" style="background-color: #aaa;">取消</button>        </div>      </div>    </form>',
            c = Handlebars.compile(b);
        return c(a)
    }, prepareWeiboBindLabel: function () {
        return '<label style="margin-left: 10px"><input class="is-weibo-bind" type="checkbox">同步到微博</label>'
    }, refreshCommentList: function () {
    }, prepareReplyItem: function (a, b) {
        var c = $.extend(currentUser, {content: a, anonymous: b}),
            d = Handlebars.compile(SB.TPL.replyListItem);
        return d(c)
    }, escapeHtml: function (a) {
        return a.replace(/</g, "&lt;").replace(/>/g, "&gt;")
    }
}, SB.TPL = {
    commentListItem: '<li>      <div class="clearfix">        <div class="pull-left">          {{#if anonymous}}          <img src="/static/images/anonymous.jpg" alt="" class="avatar-b img-circle"/>          {{else}}          <img src="{{ avatar }}" alt="{{ nickname }}" class="avatar-b img-circle">          {{/if}}        </div>        <div class="pull-left  comment-wrapper">          <div class="user-info">            {{#if anonymous}}            <span class="user-name">匿名者</span>            {{else}}            <a class="user-name" href="/accounts/profile/{{ username }}">{{ nickname }}</a>            <i class="sebug-icon icon-user-level-{{ level }}"></i>            {{/if}}            <time>刚刚</time>          </div>          <div class="comment-content">{{ content }}</div>        </div>      </div>      <div class="operation"></div>    </li>',
    replyListItem: ' <li>        {{#if anonymous}}        <span class="reply-user-name">匿名者</span>        {{else}}        <a href="/accounts/profile/{{username}}" class="reply-user-name">{{nickname}}</a>        {{/if}}        <div class="reply-content">{{content}}</div>      </li>'
}, SB.showMessage = function (a, b) {
    b = b || "success";
    var c = '<div class="message-holder animated fadeInUp {{type}}"><span class="content">{{message}}</span></div>',
        d = Handlebars.compile(c, {noEscape: !0}),
        e = $(d({message: a, type: b})).appendTo("body");
    window.setTimeout(function () {
        e.addClass("fadeOutUp")
    }, 2e3), window.setTimeout(function () {
        e.remove()
    }, 3e3)
}, SB.showModal = function (a, b) {
    var c = '<div class="modal fade" tabindex="-1" role="dialog" id="plugin_comment_modal"> <div class="modal-dialog modal-sm" role="document"> <div class="modal-content"> <div class="modal-header"> <div class="header modal-title">{{title}}</div> </div> <div class="modal-body"> {{{message}}} </div> </div></div></div>';
    var d = Handlebars.compile(c);
    var e = $(d({
        title: a,
        message: b
    })).appendTo(".plugin_comment");
    $('#plugin_comment_modal').modal('toggle');
};
$.ajaxSetup({
    beforeSend: function (a, b) {
        csrfSafeMethod(b.type) || this.crossDomain || a.setRequestHeader("X-CSRFToken", $("[name=csrfmiddlewaretoken]").val())
    }, error: function () {
        SB.showMessage("请求出错了，请刷新重试", "error")
    }
}), $(function () {
    $('[data-toggle="tooltip"]').length > 0 && $('[data-toggle="tooltip"]').tooltip(), $("#J-jump-form").on("click", "a", function () {
        var a = $(this).parent().find("input"), b = parseInt(a.attr("max")),
            c = parseInt(String.prototype.trim.call(a.val()));
        /^\d*$/.test(c) && c > 0 && b >= c && (window.location.href = window.location.pathname + "?page=" + c)
    }), $(".j-goto-top").click(function (a) {
        a.preventDefault(), $("body, html").animate({scrollTop: 0}, 800)
    })
});
