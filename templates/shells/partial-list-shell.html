{% for shell in shells %}
                <tr>                  
                  <td class="align-middle text-center">
                    <input type="checkbox" class="row-checkbox m-0"
                           style="
                             width: 18px;
                             height: 18px;
                             cursor: pointer;
                             border: 2px solid #c9c2c2;
                             border-radius: 4px;
                             accent-color: #f97316;
                             color: #fff;
                             transition: all 0.2s ease;
                           "
                           data-shell-id="{{shell.connection_id}}"
                           onchange="onshellCheckboxChange(this)">
                  </td>
                  <td>
                    <div class="d-flex px-2 py-1">
                      <div>
                        <!-- ảnh hệ điều hành -->
                        <img                          
                          src="{{ url_for('static', filename='assets/img/shell.png') }}" 
                          class="avatar avatar-sm me-3"
                        />
                      
                      </div>
                      <div class="d-flex flex-column justify-content-center">
                        <h6 class="mb-0 text-sm">
                          <a href="javascript:">
                          Local: {{ shell.local_ip }}:{{shell.local_port}}
                          </a>
                        </h6> 
                        <p class="text-xs text-secondary mb-0">
                          Remote: {{ shell.remote_ip }}:{{shell.remote_port}}
                        </p>
                      </div>
                    </div>
                  </td>
                  <td>
                    <!-- Badge trạng thái shell -->
                    {% if shell.status.name == 'LISTENING' %}
                    <span class="badge bg-gradient-success ms-1">LISTENING</span>
                    {% elif shell.status.name == 'CONNECTED' %}
                    <span class="badge bg-gradient-info ms-1">CONNECTED</span>
                    {% elif shell.status.name == 'CLOSED' %}
                    <span class="badge bg-gradient-secondary ms-1">CLOSED</span>
                    {% elif shell.status.name == 'ERROR' %}
                    <span class="badge bg-gradient-danger ms-1">ERROR</span>
                    {% else %}
                    <span class="badge bg-gradient-dark ms-1">{{ shell.status.name }}</span>
                    {% endif %}
                  </td>
                  <td class="align-middle text-center text-sm">
                    {% if shell.shell_type.name == 'REVERSE' %}
                      <span class="badge bg-gradient-warning">Reverse Shell</span>
                    {% elif shell.shell_type.name == 'BIND' %}
                      <span class="badge bg-gradient-info">Bind Shell</span>
                    {% elif shell.shell_type.name == 'WEBSHELL' %}
                      <span class="badge bg-gradient-success">WebShell</span>
                    {% elif shell.shell_type.name == 'SSH' %}
                      <span class="badge bg-gradient-secondary">SSH</span>
                    {% else %}
                      <span class="badge bg-gradient-dark">{{ shell.shell_type.name }}</span>
                    {% endif %}
                    <p class="text-xs text-secondary mb-0" >
                      <!--StatusCode: 400-->
                    </p>
                  </td>
                  <td>
                    <p class="text-xs font-weight-bold mb-0">User: {{shell.user}}</p> 
                    <p class="text-xs text-secondary mb-0">
                      {{ shell.privilege_level }}
                    </p>
                  </td>
                  <td>
                    <p class="text-xs font-weight-bold mb-0">
                      <i class="fas fa-calendar-alt"></i> Created:
                      {{ shell.created_at|replace('T', ' ')|truncate(19, True, '') if shell.created_at }}
                    </p>
                    <p class="text-xs text-secondary mb-0">
                      <i class="fas fa-clock"></i> Updated:
                      {{ shell.updated_at|replace('T', ' ')|truncate(19, True, '') if shell.updated_at }}
                    </p>
                  </td>
                  <td class="align-middle">
                    <div class="d-flex gap-2">
                      <button class="btn btn-sm btn-outline-success" title="Bật/Tắt Shell"
                        onclick="HandleActionShell('{{shell.connection_id}}', '{{shell.status.name}}')">
                        {% if shell.status.name == 'CLOSED' %}
                          <i class="fa fa-play"></i> Turn ON
                        {% else %}
                          <i class="fa fa-stop"></i> Turn OFF
                        {% endif %}
                      </button>
                      <button class="btn btn-sm btn-outline-info" title="Xem Shell"
                        onclick="HandViewShell('{{shell.connection_id}}')">
                        <i class="fa fa-eye"></i> Xem
                      </button>
                    </div>
                  </td>
                </tr>
                {% endfor %}

                
<!-- xử lý bật tắt shell-->
<script>
function HandleActionShell(connectionID, nowaction){
  // lấy acction hiện tại của shell
  if(nowaction == 'CLOSED'){
    console.log('Bật Shell');
    //nếu đang tắt thì giờ mình đi bất
    if(confirm("Do you want to start Shell?")){
      $.ajax({
        url:`/api/shells/${connectionID}/start`,
        type: 'POST',
        success:  function(resp) {
          if(resp.status == 'success'){
            //Làm 1 cái notic thông bác 
            alert("Enabled successful");
            showContent(currentPage, document.getElementById("id_search_shell").value, currentSortType);
          }
          else{
            alert(`${resp.msg}`);
          }
        },
        error: function(error){
          alert(`${error.msg}`);
        }
      });
    }
    
  } else {
    console.log('Tắt Shell');
    //nếu không phải là đang tắt thì mình tắt hết
    if(confirm("Are you sure you want to close Shell?")){
      $.ajax({
        url: `/api/shells/${connectionID}/close`,
        type: 'POST',
        success: function(resp){
          if(resp.status== 'success'){
            /// lam cai NOti o day
            
            alert('thanhf coong tawst');
            showContent(currentPage, document.getElementById("id_search_shell").value, currentSortType);
          }
          else{
            alert(`${resp.msg}`);
          }
        },
        error: function(error){
          alert(`${error.msg}`)
        }
      });
    };
  }
}
</script>

<!-- Xem 1 shell-->
