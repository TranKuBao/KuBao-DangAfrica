{% for poc in pocs %}

<tr>
  <td>
    <div class="d-flex px-2 py-1">
      <div>
        <!-- ảnh hệ điều hành -->
        <img
          src="{{ url_for('static', filename='assets/img/shield.png') }}"
          class="avatar avatar-sm me-3"
          alt="user1"
        />
      </div>
      <div class="d-flex flex-column justify-content-center">
        <h6 class="mb-0 text-sm" style="width: 200px; min-width: 120px; white-space: normal !important; word-break: break-word !important;">{{ poc.name }}</h6>
        <p class="text-xs text-secondary mb-0">{{ poc.vulType }}</p>
      </div>
    </div>
  </td>
  <td>
    <div d-flex flex-column justify-content-center>
      <p class="mb-0 text-sm" style="width: 360px; min-width: 120px; white-space: normal !important; word-break: break-word !important;">
        {{ poc.appversion }}
      </p>
      <p class="text-xs text-secondary mb-0"></p>
    </div>
  </td>
  <td class="align-middle text-sm">
    <span class="mb-0 text-sm" style="color:black !important;">{{ poc.appname }}</span>
  </td>
  <td>
    <p class="text-xs font-weight-bold mb-0">Au:{{ poc.author}}</p> 
    <p class="text-xs text-secondary mb-0">
      Refer: {{ poc.references }}
    </p>
  </td>                
  <td class="align-middle">
    <a
      class="cursor-pointer"
      id="dropdownTable"
      data-bs-toggle="dropdown"
      aria-expanded="false"
    >
      <i class="fa fa-ellipsis-v text-secondary"></i>
    </a>
    <ul
      class="dropdown-menu px-2 py-3 ms-sm-n4 ms-n5"
      aria-labelledby="dropdownTable"
      style="color: black !important; border: 1px solid black !important"
    >
      <li>
        <a
          class="dropdown-item border-radius-md"
          href="/view-poc?poc_path={{ poc.path | urlencode }}""
          style="color: black !important"
          data-poc-id="{{ poc.path }}"
          >Xem</a
        >
      </li>
      <li>
        <a
          class="dropdown-item border-radius-md"
          href="javascript:void(0);"
          style="color: black !important"
          data-poc-id="{{poc.path}}"
          onclick="showPocModal('{{poc.path}}')"
          >Sử dụng</a
        >
      </li>
      

      <li>
        <a
          class="dropdown-item border-radius-md"
          href="javascript:;"
          style="color: black !important"
          data-poc-id="{{poc.path}}"
          >Xóa</a
        >
      </li>
    </ul>
  </td>
</tr>


{% endfor %}
<script>
  function showPocModal(pocpath) {
  console.log("path: ",pocpath);
  document.getElementById('pocModalLabel').innerText = 'POC: ' + pocpath.slice(4);
  document.getElementById('target-value').value = 'http://vulbox.com' || '';
  document.getElementById('rport-value').value = 1337 || '';
  // ... cập nhật các field khác
  // Lấy thông tin modes từ API
  $.ajax({
      url: '/get-poc-info',
      type: 'POST',
      data: {
        poc_path: pocpath.slice(4),
      },
    })
    .done((response) => {
      console.log("Response from get-poc-info:", response); // Thêm log để debug
      if (response['status'] === 0) {
        const modes = response['data']['modes'];
        console.log("Modes:", modes); // Thêm log để debug
        
        // Hiển thị/ẩn các button dựa trên modes hỗ trợ
        const verifyBtn = document.getElementById('btn-verify');
        const attackBtn = document.getElementById('btn-attack');
        const shellBtn = document.getElementById('btn-shell');        
        // Ẩn tất cả button trước
        verifyBtn.style.display = 'none';
        attackBtn.style.display = 'none';
        shellBtn.style.display = 'none';        
        // Hiển thị button theo modes hỗ trợ
        if (modes && modes.includes('verify')) {
          verifyBtn.style.display = 'inline-block';
        }
        if (modes && modes.includes('attack')) {
          attackBtn.style.display = 'inline-block';
        }
        if (modes && modes.includes('shell')) {
          shellBtn.style.display = 'inline-block';
        }


        // Hiển thị giao diện module option 
        const options = response['data']['options'] || [];
        const dynamicOptionsDiv = document.getElementById('dynamic-options');
        dynamicOptionsDiv.innerHTML = '';
        options.forEach(opt => {
          const [name, value, type, desc] = opt;
          dynamicOptionsDiv.innerHTML += `
            <div class="form-group mb-2">
              <label class="col-form-label font-weight-semibold">${name} (${type})</label>
              <input type="text" class="form-control" id="opt-${name}" value="${value || ''}" placeholder="${desc || ''}">
            </div>
          `;
        });

      }
    })
    .fail((error) => {
      console.error("Lỗi khi lấy thông tin PoC:", error);
    });
    
  const modal = new bootstrap.Modal(document.getElementById('pocModal'));
  modal.show();
}
</script>