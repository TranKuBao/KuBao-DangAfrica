<!-- create Weevely Payload Form -->
<div class="row my-3" id="createPayloadshell-hidden" hidden>
    <div class="col-12">
      <div class="card mb-4">
        <div class="card-header pb-0 p-3">
          <div class="row">
            <div class="col-6 d-flex align-items-center">
              <h6 class="mb-0" style="margin-left: 20px !important;">Add Weevely Payload</h6>
            </div>
            <div class="col-6 text-end">
              <button class="btn btn-outline-secondary btn-sm" onclick="on_off_createPayloadshell()">
                <i class="fas fa-times"></i> Close
              </button>
            </div>
          </div>
        </div>
        <div class="card-body">
          <form id="create-weevely-payload-form">
            <div class="row">
              <!-- Basic Information -->
              <div class="col-md-6">
                <div class="form-group">
                  <label for="weevely-name" class="form-label">Weevely Payload File-Name *</label>
                  <div class="d-flex align-items-center">
                    <input type="text" class="form-control" id="weevely-payload-filename" name="weevely-payload-filename" 
                           placeholder="e.g., Production Server" required>
                    <span class="ms-2 fw-bold text-primary" style="color: #000000 !important; margin-left: 0px !important;">.php</span>
                  </div>
                  <small class="form-text text-muted">Friendly name for this weevely payload</small>
                </div>
              </div>
              <div class="col-md-6">
                <div class="form-group">
                  <label for="weevely-password" class="form-label">Password *</label>
                  <div class="input-group">
                    <input type="password" class="form-control" id="weevely-payload-password" name="weevely-payload-password" 
                           placeholder="Enter backdoor password" required>
                    <button class="btn btn-outline-secondary" type="button" onclick="togglePasswordVisibility('weevely-payload-password')">
                      <i class="fas fa-eye"></i>
                    </button>
                  </div>
                  <small class="form-text text-muted">Password for the weevely backdoor</small>
                </div>
              </div>
            </div>
  
            <!-- Action Buttons -->
            <div class="row mt-4">
              <div class="col-12">
                <div class="d-flex gap-2">
                  <button type="submit" class="btn bg-gradient-success" id="submit-weevely-payload-btn">
                    <i class="fas fa-plus"></i> Create Weevely Payload
                  </button>
                  <button type="button" class="btn bg-gradient-secondary" onclick="resetForm()">
                    <i class="fas fa-undo"></i> Reset Form
                  </button>
                  <button type="button" class="btn bg-gradient-info" onclick="generateRandomPassword()">
                    <i class="fas fa-key"></i> Generate Password
                  </button>
                </div>
              </div>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>


  <script>
    // Toggle password visibility
    function togglePasswordVisibility(inputId) {
        const input = document.getElementById(inputId);
        const button = input.nextElementSibling.querySelector('i');
        
        if (input.type === 'password') {
            input.type = 'text';
            button.classList.remove('fa-eye');
            button.classList.add('fa-eye-slash');
        } else {
            input.type = 'password';
            button.classList.remove('fa-eye-slash');
            button.classList.add('fa-eye');
        }
    }
    // Reset form
    function resetForm() {
        document.getElementById('create-weevely-payload-form').reset();
        }
    
    // Generate random password
    function generateRandomPassword() {
        const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&*';
        let password = '';
        for (let i = 0; i < 16; i++) {
            password += chars.charAt(Math.floor(Math.random() * chars.length));
        }
        document.getElementById('weevely-payload-password').value = password;
    }

    //submit form
    document.getElementById('submit-weevely-payload-btn').addEventListener('click', function(event) {
        event.preventDefault();
        const file_name = document.getElementById('weevely-payload-filename').value;
        const password = document.getElementById('weevely-payload-password').value;
        
        if (!file_name || !password) {
            alert('Please fill in all fields');
            return;
        }

        //call api to create weevely payload
        fetch('/api/weevely/create-weevely-payload', {
            method: 'POST',
            body: JSON.stringify({ file_name, password }),
        });
    });
  </script>