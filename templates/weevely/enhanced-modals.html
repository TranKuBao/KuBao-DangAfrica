<!-- Enhanced Weevely Modals for Upload/Download and Cron -->

<!-- Upload/Download Modal -->
<div class="modal fade" id="uploadDownloadModal" tabindex="-1" aria-labelledby="uploadDownloadModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-xl">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="uploadDownloadModalLabel">
          <i class="fas fa-exchange-alt"></i> File Upload & Download Manager
        </h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <!-- Tab Navigation -->
        <ul class="nav nav-tabs" id="uploadDownloadTabs" role="tablist">
          <li class="nav-item" role="presentation">
            <button class="nav-link active" id="upload-tab" data-bs-toggle="tab" data-bs-target="#upload-pane" type="button" role="tab">
              <i class="fas fa-upload"></i> Upload to Target
            </button>
          </li>
          <li class="nav-item" role="presentation">
            <button class="nav-link" id="webdownload-tab" data-bs-toggle="tab" data-bs-target="#webdownload-pane" type="button" role="tab">
              <i class="fas fa-cloud-download-alt"></i> Web Download
            </button>
          </li>
          <li class="nav-item" role="presentation">
            <button class="nav-link" id="download-tab" data-bs-toggle="tab" data-bs-target="#download-pane" type="button" role="tab">
              <i class="fas fa-download"></i> Download from Target
            </button>
          </li>
          <li class="nav-item" role="presentation">
            <button class="nav-link" id="cron-tab" data-bs-toggle="tab" data-bs-target="#cron-pane" type="button" role="tab">
              <i class="fas fa-clock"></i> Cron Downloads
            </button>
          </li>
        </ul>

        <div class="tab-content mt-3" id="uploadDownloadTabContent">
          <!-- Upload Tab -->
          <div class="tab-pane fade show active" id="upload-pane" role="tabpanel">
            <div class="row">
              <div class="col-md-6">
                <div class="card border">
                  <div class="card-header">
                    <h6 class="mb-0">Select File to Upload</h6>
                  </div>
                  <div class="card-body">
                    <div class="form-group">
                      <label class="form-label">Local File</label>
                      <input type="file" id="upload_file" class="form-control" accept="*/*">
                      <small class="text-muted">Select file from your computer</small>
                    </div>
                    
                    <div class="form-group">
                      <label class="form-label">Target Path</label>
                      <input type="text" id="upload_target_path" class="form-control" placeholder="/tmp/uploaded_file.txt">
                      <small class="text-muted">Full path where file will be saved on target</small>
                    </div>
                    
                    <div class="form-group">
                      <label class="form-label">Upload Vector</label>
                      <select id="upload_vector" class="form-control">
                        <option value="file_put_contents">file_put_contents (default)</option>
                        <option value="fwrite">fwrite</option>
                        <option value="curl">curl upload</option>
                        <option value="base64">base64 encode</option>
                      </select>
                    </div>
                  </div>
                </div>
              </div>
              
              <div class="col-md-6">
                <div class="card border">
                  <div class="card-header">
                    <h6 class="mb-0">Upload Progress</h6>
                  </div>
                  <div class="card-body">
                    <div id="upload_progress" class="mb-3">
                      <div class="progress">
                        <div class="progress-bar" role="progressbar" style="width: 0%" id="upload_progress_bar">0%</div>
                      </div>
                    </div>
                    
                    <div id="upload_status" class="alert alert-info">
                      <i class="fas fa-info-circle"></i> Select a file and target path to begin upload
                    </div>
                    
                    <div class="d-grid">
                      <button class="btn btn-primary" onclick="executeFileUpload()" id="upload_btn">
                        <i class="fas fa-upload"></i> Start Upload
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Web Download Tab -->
          <div class="tab-pane fade" id="webdownload-pane" role="tabpanel">
            <div class="row">
              <div class="col-md-8">
                <div class="card border">
                  <div class="card-header">
                    <h6 class="mb-0">Download from URL to Target</h6>
                  </div>
                  <div class="card-body">
                    <div class="form-group">
                      <label class="form-label">Source URL</label>
                      <input type="url" id="webdownload_url" class="form-control" 
                             placeholder="https://example.com/file.zip">
                      <small class="text-muted">URL of file to download</small>
                    </div>
                    
                    <div class="form-group">
                      <label class="form-label">Target Save Path</label>
                      <input type="text" id="webdownload_path" class="form-control" 
                             placeholder="/tmp/downloaded_file.zip">
                      <small class="text-muted">Where to save the file on target server</small>
                    </div>
                    
                    <div class="row">
                      <div class="col-md-6">
                        <div class="form-group">
                          <label class="form-label">Download Method</label>
                          <select id="webdownload_method" class="form-control">
                            <option value="curl">cURL (default)</option>
                            <option value="wget">wget</option>
                            <option value="file_get_contents">file_get_contents</option>
                          </select>
                        </div>
                      </div>
                      <div class="col-md-6">
                        <div class="form-group">
                          <label class="form-label">Timeout (seconds)</label>
                          <input type="number" id="webdownload_timeout" class="form-control" value="300" min="30" max="3600">
                        </div>
                      </div>
                    </div>
                    
                    <div class="form-check">
                      <input class="form-check-input" type="checkbox" id="webdownload_verify" checked>
                      <label class="form-check-label" for="webdownload_verify">
                        Verify download integrity
                      </label>
                    </div>
                  </div>
                </div>
              </div>
              
              <div class="col-md-4">
                <div class="card border">
                  <div class="card-header">
                    <h6 class="mb-0">Quick URLs</h6>
                  </div>
                  <div class="card-body">
                    <div class="d-grid gap-2">
                      <button class="btn btn-sm btn-outline-primary" onclick="setWebDownloadUrl('https://github.com/danielmiessler/SecLists/archive/refs/heads/master.zip', '/tmp/seclists.zip')">
                        SecLists
                      </button>
                      <button class="btn btn-sm btn-outline-primary" onclick="setWebDownloadUrl('https://raw.githubusercontent.com/carlospolop/PEASS-ng/master/linPEAS/linpeas.sh', '/tmp/linpeas.sh')">
                        LinPEAS
                      </button>
                      <button class="btn btn-sm btn-outline-primary" onclick="setWebDownloadUrl('https://github.com/DominicBreuker/pspy/releases/download/v1.2.1/pspy64', '/tmp/pspy64')">
                        Pspy64
                      </button>
                      <button class="btn btn-sm btn-outline-secondary" onclick="setWebDownloadUrl('https://raw.githubusercontent.com/rebootuser/LinEnum/master/LinEnum.sh', '/tmp/linenum.sh')">
                        LinEnum
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            
            <div class="row mt-3">
              <div class="col-12">
                <div class="d-flex justify-content-between">
                  <div>
                    <button class="btn btn-success" onclick="executeWebDownload()">
                      <i class="fas fa-cloud-download-alt"></i> Start Download
                    </button>
                    <button class="btn btn-info" onclick="checkDownloadProgress()">
                      <i class="fas fa-search"></i> Check Progress
                    </button>
                  </div>
                  <div>
                    <button class="btn btn-outline-warning" onclick="addToCronDownload()">
                      <i class="fas fa-clock"></i> Schedule Download
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Download from Target Tab -->
          <div class="tab-pane fade" id="download-pane" role="tabpanel">
            <div class="row">
              <div class="col-md-8">
                <div class="card border">
                  <div class="card-header">
                    <h6 class="mb-0">Download from Target Server</h6>
                  </div>
                  <div class="card-body">
                    <div class="form-group">
                      <label class="form-label">Remote File Path</label>
                      <input type="text" id="download_remote_path" class="form-control" 
                             placeholder="/var/www/html/config.php">
                      <small class="text-muted">Full path to file on target server</small>
                    </div>
                    
                    <div class="form-group">
                      <label class="form-label">Local Save Path</label>
                      <input type="text" id="download_local_path" class="form-control" 
                             placeholder="./downloads/config.php">
                      <small class="text-muted">Where to save on your local system</small>
                    </div>
                    
                    <div class="row">
                      <div class="col-md-6">
                        <div class="form-group">
                          <label class="form-label">Download Vector</label>
                          <select id="download_vector" class="form-control">
                            <option value="file_get_contents">file_get_contents</option>
                            <option value="fread">fread</option>
                            <option value="base64">base64 encode</option>
                            <option value="curl">curl</option>
                          </select>
                        </div>
                      </div>
                      <div class="col-md-6">
                        <div class="form-group">
                          <label class="form-label">Encoding</label>
                          <select id="download_encoding" class="form-control">
                            <option value="binary">Binary</option>
                            <option value="base64">Base64</option>
                            <option value="utf8">UTF-8</option>
                          </select>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              
              <div class="col-md-4">
                <div class="card border">
                  <div class="card-header">
                    <h6 class="mb-0">Common Files</h6>
                  </div>
                  <div class="card-body">
                    <div class="d-grid gap-2">
                      <button class="btn btn-sm btn-outline-danger" onclick="setDownloadPath('/etc/passwd')">
                        /etc/passwd
                      </button>
                      <button class="btn btn-sm btn-outline-danger" onclick="setDownloadPath('/etc/shadow')">
                        /etc/shadow
                      </button>
                      <button class="btn btn-sm btn-outline-warning" onclick="setDownloadPath('/var/log/auth.log')">
                        auth.log
                      </button>
                      <button class="btn btn-sm btn-outline-info" onclick="setDownloadPath('/var/www/html/wp-config.php')">
                        wp-config.php
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            
            <div class="row mt-3">
              <div class="col-12">
                <button class="btn btn-primary" onclick="executeFileDownload()">
                  <i class="fas fa-download"></i> Download File
                </button>
              </div>
            </div>
          </div>

          <!-- Cron Downloads Tab -->
          <div class="tab-pane fade" id="cron-pane" role="tabpanel">
            <div class="row">
              <div class="col-md-6">
                <div class="card border">
                  <div class="card-header">
                    <h6 class="mb-0">Schedule New Download</h6>
                  </div>
                  <div class="card-body">
                    <div class="form-group">
                      <label class="form-label">Download URL</label>
                      <input type="url" id="cron_download_url" class="form-control" 
                             placeholder="https://example.com/file.zip">
                    </div>
                    
                    <div class="form-group">
                      <label class="form-label">Target Path</label>
                      <input type="text" id="cron_target_path" class="form-control" 
                             placeholder="/tmp/scheduled_file.zip">
                    </div>
                    
                    <div class="form-group">
                      <label class="form-label">Schedule Type</label>
                      <select id="cron_schedule_type" class="form-control" onchange="updateCronOptions()">
                        <option value="once">Once (Delayed)</option>
                        <option value="hourly">Every Hour</option>
                        <option value="daily">Daily</option>
                        <option value="weekly">Weekly</option>
                        <option value="custom">Custom Cron</option>
                      </select>
                    </div>
                    
                    <div id="cron_schedule_options">
                      <div class="form-group">
                        <label class="form-label">Delay (minutes)</label>
                        <input type="number" id="cron_delay" class="form-control" value="5" min="1" max="1440">
                      </div>
                    </div>
                    
                    <div class="form-group" id="custom_cron_group" style="display: none;">
                      <label class="form-label">Custom Cron Expression</label>
                      <input type="text" id="custom_cron_expr" class="form-control" 
                             placeholder="0 2 * * * (daily at 2 AM)">
                      <small class="text-muted">Format: minute hour day month weekday</small>
                    </div>
                    
                    <div class="form-check">
                      <input class="form-check-input" type="checkbox" id="cron_auto_cleanup" checked>
                      <label class="form-check-label" for="cron_auto_cleanup">
                        Auto cleanup after download
                      </label>
                    </div>
                  </div>
                </div>
              </div>
              
              <div class="col-md-6">
                <div class="card border">
                  <div class="card-header d-flex justify-content-between">
                    <h6 class="mb-0">Scheduled Downloads</h6>
                    <button class="btn btn-sm btn-outline-primary" onclick="refreshCronList()">
                      <i class="fas fa-refresh"></i> Refresh
                    </button>
                  </div>
                  <div class="card-body">
                    <div id="cron_downloads_list">
                      <!-- Cron downloads will be loaded here -->
                      <div class="text-center text-muted">
                        <i class="fas fa-clock fa-2x mb-2"></i>
                        <p>No scheduled downloads</p>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            
            <div class="row mt-3">
              <div class="col-12">
                <div class="d-flex justify-content-between">
                  <button class="btn btn-success" onclick="scheduleCronDownload()">
                    <i class="fas fa-clock"></i> Schedule Download
                  </button>
                  <div>
                    <button class="btn btn-outline-warning" onclick="pauseAllCrons()">
                      <i class="fas fa-pause"></i> Pause All
                    </button>
                    <button class="btn btn-outline-danger" onclick="clearAllCrons()">
                      <i class="fas fa-trash"></i> Clear All
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <div class="modal-footer">
        <div class="d-flex justify-content-between w-100">
          <div>
            <span class="text-muted">
              <i class="fas fa-info-circle"></i>
              <span id="modal_connection_status">No connection selected</span>
            </span>
          </div>
          <div>
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- File Search Results Modal -->
<div class="modal fade" id="fileSearchResultsModal" tabindex="-1" aria-labelledby="fileSearchResultsLabel" aria-hidden="true">
  <div class="modal-dialog modal-xl">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="fileSearchResultsLabel">
          <i class="fas fa-search"></i> File Search Results
        </h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div class="row mb-3">
          <div class="col-md-8">
            <div class="search-info alert alert-info">
              <strong>Search Parameters:</strong>
              <div id="search_params_display"></div>
            </div>
          </div>
          <div class="col-md-4">
            <div class="search-stats">
              <div class="card border">
                <div class="card-body text-center">
                  <h4 id="files_found_count" class="text-primary">0</h4>
                  <small class="text-muted">Files Found</small>
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <div class="row">
          <div class="col-12">
            <div class="table-responsive">
              <table class="table table-hover">
                <thead class="table-dark">
                  <tr>
                    <th>
                      <input type="checkbox" id="select_all_files" onchange="toggleAllFileSelection()">
                    </th>
                    <th>File Path</th>
                    <th>Permissions</th>
                    <th>Size</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody id="search_results_table">
                  <!-- Search results will be populated here -->
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      
      <div class="modal-footer">
        <div class="d-flex justify-content-between w-100">
          <div>
            <button class="btn btn-outline-primary" onclick="downloadSelectedFiles()">
              <i class="fas fa-download"></i> Download Selected
            </button>
            <button class="btn btn-outline-info" onclick="addSelectedToCron()">
              <i class="fas fa-clock"></i> Schedule Selected
            </button>
          </div>
          <div>
            <button class="btn btn-outline-secondary" onclick="exportSearchResults()">
              <i class="fas fa-file-export"></i> Export Results
            </button>
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
