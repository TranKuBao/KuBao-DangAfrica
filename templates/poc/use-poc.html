<div class="modal fade" id="pocModal" tabindex="-1" aria-labelledby="pocModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-xl">
    <div class="modal-content shadow-lg" style="background-color: #f8f9fa; border-radius: 12px;">
      <div class="modal-header bg-primary text-white" style="background-color: #e9ecef !important;">
        <h5 class="modal-title font-weight-bold" id="pocModalLabel">Proof of Concept (POC)</h5>
        <button type="button" class="btn btn-hacker-danger px-4 ms-auto" data-bs-dismiss="modal"
          style="margin-top: 10px !important;">✖ Close</button>
      </div>
      <div class="modal-body p-4">
        <div class="row">
          <!-- Target Options -->
          <div class="col-md-6 p-3 bg-white rounded shadow-sm mb-3">
            <h5 class="mb-3 text-primary">Target Options</h5>
            <div class="form-group" style="position: relative;">
              <label for="target-value" class="col-form-label font-weight-semibold">Target URL</label>
              <div class="input-group align-items-center">
                <input type="text" class="form-control" id="target-value" placeholder="Enter target URL" autocomplete="off" />
                <button class="btn btn-outline-secondary" type="button" id="btn-select-target" style="margin-top: 15px !important;">
                  <i class="fa fa-list"></i> Chọn Target
                </button>
              </div>
              <div id="dropdown-targets" class="dropdown-menu" style="max-height: 200px; overflow-y: auto; position: absolute; z-index: 9999;"></div>
            </div>
            <div class="form-group" style="display: none;">
              <div class="form-check">
                <input class="form-check-input" type="checkbox" id="chkBoxFileTarget" />
                <label class="form-check-label" for="chkBoxFileTarget">Target from File</label>
              </div>
              <!--<input type="file" id="multiFiles" name="files[]" multiple="multiple" />-->
            </div>
            <div class="form-group">
              <label for="rport-value" class="col-form-label font-weight-semibold">Remote Port (RPORT)</label>
              <input type="text" class="form-control" id="rport-value" placeholder="Enter remote port" />
            </div>
          </div>

          <!-- Module Options -->
          <div class="col-md-6 p-3 bg-white rounded shadow-sm mb-3">
            <h5 class="mb-3 text-primary">Module Options</h5>
            <div id="dynamic-options">
            <!---->
            </div>
          </div>

          <!-- Payload Options -->
        <div class="col-md-6 p-3 bg-white rounded shadow-sm mb-3">
            <h5 class="mb-3 text-primary">Payload Options</h5>
            <div class="form-group" style="display: none;">
              <label for="payload-value" class="col-form-label font-weight-semibold">Payload</label>
              <input type="text" class="form-control" id="payload-value" placeholder="Enter payload" />
            </div>
            <div class="form-group">
              <label for="lhost-value" class="col-form-label font-weight-semibold">Local Host (LHOST)</label>
              <input type="text" class="form-control" id="opt-lhost" placeholder="Enter local host" />
            </div>
            <div class="form-group">
              <label for="lport-value" class="col-form-label font-weight-semibold">Local Port (LPORT)</label>
              <input type="text" class="form-control" id="opt-lport" placeholder="Enter local port" />
            </div>
          </div>
        
      </div>

        <!-- Result Section -->
        <div class="row p-3">
          <div class="col-12 bg-light rounded p-3" id="result">
            <h6 class="text-muted" id="h6-output-result">Results will appear here...</h6>
            <p class="text-muted" id="output-result"></p>
          </div>
        </div>
      </div>
      <div class="modal-footer" style="background-color: #FFFFFF;">
        <div class="d-flex justify-content-center flex-wrap w-100 gap-2">
          <button type="button" class="btn btn-hacker mx-2 px-4" id="btn-verify" onclick="verify_click()">
            ▷ Verify
          </button>
          <button type="button" class="btn btn-hacker-warning mx-2 px-4" id="btn-attack" onclick="attack_click()">
            ⚠ Attack
          </button>
          <button type="button" class="btn btn-hacker mx-2 px-4" id="btn-shell">
            ⛓ Shell
          </button>
        </div>
      </div>

    </div>
  </div>
</div>

<!-- Additional CSS for Enhanced Styling -->
<style>
#target-value,
#btn-select-target {
  height: 40px !important;
  box-sizing: border-box;
}

#target-value {
  border-top-right-radius: 0 !important;
  border-bottom-right-radius: 0 !important;
}

#btn-select-target {
  border-top-left-radius: 0 !important;
  border-bottom-left-radius: 0 !important;
  padding-top: 0;
  padding-bottom: 0;
  font-weight: 500;
  min-width: 120px;
  display: flex;
  align-items: center;
  justify-content: center;
}

.input-group:focus-within {
  box-shadow: none !important;
  border-color: #ced4da !important;
}



.input-group {
  width: 100%;
}
  .modal-content {
    transition: all 0.3s ease;
  }

  .modal-content:hover {
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
  }

  .form-control:focus {
    border-color: #007bff;
    box-shadow: 0 0 5px rgba(0, 123, 255, 0.3);
  }

  .btn {
    transition: all 0.2s ease;
  }

  .btn:hover {
    transform: translateY(-2px);
  }

  .modal-header {
    border-bottom: 2px solid #e9ecef;
  }

  .modal-footer {
    border-top: 2px solid #e9ecef;
  }

  .modal-header {
    padding-top: 0.25rem !important;
    padding-bottom: 0.25rem !important;
    padding-left: 1rem !important;
    padding-right: 1rem !important;
    min-height: 28px;
    align-items: center !important;
  }

  h5.text-primary {
    font-weight: 600;
  }

  .shadow-sm {
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1) !important;
  }

  .btn-hacker {
    font-family: 'Courier New', monospace;
    border: 1px solid #fff;
    background-color: #f97316;
    color: #fff;
    padding: 10px 20px;
    border-radius: 4px;
    transition: all 0.3s ease;
    box-shadow: 0 0 5px #f97316;
  }

  .btn-hacker:hover {
    background-color: #f97316;
    color: #000;
    box-shadow: 0 0 12px #f97316;
  }

  .btn-hacker-danger {
    border: 1px solid #ff0033;
    color: #ff0033;
    box-shadow: 0 0 5px #ff0033;
  }

  .btn-hacker-danger:hover {
    background-color: #ff0033;
    color: #000;
    box-shadow: 0 0 12px #ff0033;
  }

  .btn-hacker-warning {
    border: 1px solid #f97316;
    color: #f97316;
    box-shadow: 0 0 5px #f97316;
  }

  .btn-hacker-warning:hover {
    background-color: #f97316;
    color: #000;
    box-shadow: 0 0 12px #f97316;
  }
</style>

<script>
  

  



  // Lấy data để request
  function getAllInputData() {
    const data = {};
    // Lấy các trường động
    document.querySelectorAll('#dynamic-options input').forEach(input => {
      const key = input.id.replace('opt-', '');
      data[key + '-value'] = input.value;
    });
    // Lấy các trường đặc biệt nếu cần
    data['target-value'] = document.getElementById('target-value').value;
    data['rport-value'] = document.getElementById('rport-value').value;
    // ... các trường khác nếu có
    console.log("data's option",data);
    return data;
  }

  

  //gọi API verify
  function verify_click() {
    data_input = getAllInputData();

    $.ajax({
      url: '/api/verify-mode',
      type: 'POST',
      data: data_input,
    })
    .done((resp)=>{
      console.log("STATUS:",resp['status']);
      console.log('Dữ liệu',resp['data'] );
      alert(resp['data']['Message']);
      document.getElementById('h6-output-result').innerHTML = "------------------------Result for POC------------------------";

      // Xử lý kết quả trả về
      let html = '';
      if (resp['data']) {
        // Nếu là object, hiển thị từng key-value
        for (const key in resp['data']) {
          if (typeof resp['data'][key] === 'object') {
            html += `<b>${key}:</b><br>`;
            for (const subkey in resp['data'][key]) {
              html += `&nbsp;&nbsp;${subkey}: ${resp['data'][key][subkey]}<br>`;
            }
          } else {
            html += `<b>${key}:</b> ${resp['data'][key]}<br>`;
          }
        }
      } else {
        html = 'No result';
      }
      document.getElementById('output-result').innerHTML = html;

    })
  .fail((error) =>{
    console.log("Phát hiện lỗi: ",error)
  });

  }

  //gọi API verify
  function attack_click() {
    data_input = getAllInputData();

    $.ajax({
      url: '/api/attack-mode',
      type: 'POST',
      data: data_input,
    })
    .done((resp)=>{
      console.log("STATUS:",resp['status']);
      console.log('Dữ liệu',resp['data'] );
      alert(resp['data']['Message']);
      document.getElementById('h6-output-result').innerHTML = "------------------------Result for POC------------------------";

      // Xử lý kết quả trả về
      let html = '';
      if (resp['data']) {
        // Nếu là object, hiển thị từng key-value
        for (const key in resp['data']) {
          if (typeof resp['data'][key] === 'object') {
            html += `<b>${key}:</b><br>`;
            for (const subkey in resp['data'][key]) {
              html += `&nbsp;&nbsp;${subkey}: ${resp['data'][key][subkey]}<br>`;
            }
          } else {
            html += `<b>${key}:</b> ${resp['data'][key]}<br>`;
          }
        }
      } else {
        html = 'No result';
      }
      document.getElementById('output-result').innerHTML = html;

    })
  .fail((error) =>{
    console.log("Phát hiện lỗi: ",error)
  });
  }

  //gọi API verify
  function shell_click() {


    
  }

  // Khi bấm nút Chọn, hiện dropdown các target từ API mới
  $('#btn-select-target').on('click', function() {
    $.ajax({
      url: '/api/getalltarget',
      type: 'GET',
      success: function(resp) {
        let html = '';
        if (resp.targets) {
          resp.targets.forEach(t => {
            html += `<a class='dropdown-item' href='#' onclick="selectTarget('${t.hostname.replace(/'/g, "\\'")}')">${t.hostname} (${t.ip_address})</a>`;
          });
        }
        $('#dropdown-targets').html(html).toggle();
      }
    });
  });

  // Hàm chọn target
  function selectTarget(val) {
    $('#target-value').val(val);
    $('#dropdown-targets').hide();
  }

  // Ẩn dropdown khi click ngoài
  $(document).on('click', function(e) {
    if (!$(e.target).closest('#btn-select-target, #dropdown-targets').length) {
      $('#dropdown-targets').hide();
    }
  });

</script>