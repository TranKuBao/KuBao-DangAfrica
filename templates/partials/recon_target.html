<!-- Additional CSS for Enhanced Styling -->
<style>
    .CodeMirror {
        font-size: 13px !important;
        min-height: 400px;
        height: 80%;
        width: 100%;
        background: #282a36;
        border-radius: 6px;
        box-sizing: border-box;
    }

    .modal-body {
        max-height: none;
        overflow-y: visible;
        overflow-x: hidden;
        /* Ch·∫∑n cu·ªôn ngang */
        padding: 1rem 1.5rem;
    }

    .modal-content {
        transition: all 0.3s ease;
    }

    .modal-content:hover {
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
    }

    .form-control:focus {
        border-color: #007bff;
        box-shadow: 0 0 5px rgba(0, 123, 255, 0.3);
    }

    .btn {
        transition: all 0.2s ease;
    }

    .btn:hover {
        transform: translateY(-2px);
    }

    .modal-header {
        border-bottom: 2px solid #e9ecef;
    }

    .modal-footer {
        border-top: 2px solid #e9ecef;
    }

    .modal-header,
    .modal-footer {
        padding-top: 0.25rem !important;
        padding-bottom: 0.25rem !important;
        padding-left: 1rem !important;
        padding-right: 1rem !important;
        min-height: 28px;
        align-items: center !important;
    }

    .modal-header .modal-title {
        font-size: 1.1rem;
        padding: 0;
        margin: 0;
    }

    h5.text-primary {
        font-weight: 600;
    }

    .shadow-sm {
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1) !important;
    }

    .btn-hacker {
        font-family: 'Courier New', monospace;
        border: 1px solid #f97316;
        background-color: #FFFFFF;
        color: #f97316;
        padding: 10px 20px;
        border-radius: 4px;
        transition: all 0.3s ease;
        box-shadow: 0 0 5px #f97316;
    }

    .btn-hacker:hover {
        background-color: #f97316;
        color: #FFFFFF;
        box-shadow: 0 0 12px #f97316;
    }

    .btn-hacker-danger {
        border: 1px solid #ff0033;
        color: #ff0033;
        box-shadow: 0 0 5px #ff0033;
    }

    .btn-hacker-danger:hover {
        background-color: #ff0033;
        color: #000;
        box-shadow: 0 0 12px #ff0033;
    }

    .btn-hacker-warning {
        border: 1px solid #f97316;
        color: #f97316;
        box-shadow: 0 0 5px #f97316;
    }

    .btn-hacker-warning:hover {
        background-color: #f97316;
        color: #000;
        box-shadow: 0 0 12px #f97316;
    }

    .btn-hacker-success {
        border: 1px solid #28a745;
        color: #28a745;
        box-shadow: 0 0 5px #28a745;
    }

    .btn-hacker-success:hover {
        background-color: #28a745;
        color: #FFFFFF;
        box-shadow: 0 0 12px #28a745;
    }

    /* POC List Styling */
    .poc-list-container {
        max-height: 300px;
        overflow-y: auto;
        border: 1px solid #dee2e6;
        border-radius: 8px;
        background: #fff;
    }

    .poc-item {
        padding: 12px 16px;
        border-bottom: 1px solid #f1f3f4;
        cursor: pointer;
        transition: all 0.2s ease;
        display: flex;
        align-items: center;
        justify-content: space-between;
    }

    .poc-item:hover {
        background-color: #f8f9fa;
        transform: translateX(5px);
    }

    .poc-item.selected {
        background-color: #e3f2fd;
        border-left: 4px solid #2196f3;
    }

    .poc-item:last-child {
        border-bottom: none;
    }

    .poc-title {
        font-weight: 600;
        color: #333;
        margin-bottom: 4px;
    }

    .poc-description {
        font-size: 12px;
        color: #666;
        margin-bottom: 4px;
    }

    .poc-cve {
        font-size: 11px;
        color: #f97316;
        font-weight: 500;
    }

    .poc-status {
        padding: 4px 8px;
        border-radius: 12px;
        font-size: 11px;
        font-weight: 500;
    }

    .status-verified {
        background-color: #d4edda;
        color: #155724;
    }

    .status-pending {
        background-color: #fff3cd;
        color: #856404;
    }

    .status-failed {
        background-color: #f8d7da;
        color: #721c24;
    }

    /* Search and Filter Section */
    .search-filter-section {
        background: #f8f9fa;
        padding: 16px;
        border-radius: 8px;
        margin-bottom: 20px;
    }

    .filter-buttons {
        display: flex;
        gap: 8px;
        margin-top: 12px;
        flex-wrap: wrap;
    }

    .filter-btn {
        padding: 6px 12px;
        border: 1px solid #dee2e6;
        background: white;
        border-radius: 20px;
        font-size: 12px;
        cursor: pointer;
        transition: all 0.2s ease;
    }

    .filter-btn.active {
        background: #f97316;
        color: white;
        border-color: #f97316;
    }

    .filter-btn:hover {
        background: #f97316;
        color: white;
        border-color: #f97316;
    }

    /* Loading Animation */
    .loading-spinner {
        display: none;
        text-align: center;
        padding: 20px;
    }

    .spinner {
        border: 3px solid #f3f3f3;
        border-top: 3px solid #f97316;
        border-radius: 50%;
        width: 30px;
        height: 30px;
        animation: spin 1s linear infinite;
        margin: 0 auto;
    }

    @keyframes spin {
        0% {
            transform: rotate(0deg);
        }

        100% {
            transform: rotate(360deg);
        }
    }

    /* Target Selection */
    .target-selection {
        background: #e3f2fd;
        padding: 12px;
        border-radius: 6px;
        margin-bottom: 16px;
        border-left: 4px solid #2196f3;
    }

    .target-count {
        font-weight: 600;
        color: #1976d2;
    }
</style>

<div class="modal fade" id="reconTargetsModal" tabindex="-1" aria-labelledby="reconTargetModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl">
        <div class="modal-content shadow-lg" style="background-color: #f8f9fa; border-radius: 12px;">
            <div class="modal-header bg-primary text-white d-flex justify-content-between align-items-center"
                style="background-color: #e9ecef !important;">
                <h5 class="modal-title font-weight-bold" id="reconTargetModalLabel">üîç Recon Targets with Tools</h5>
                <div class="d-flex gap-2" style="margin-top: 10px !important;">
                    <button type="button" class="btn btn-hacker-success px-4" onclick="xxxxxx()">
                        <i class="fas fa-play"></i> Run <!--m√†u xanh-->
                    </button>
                    <button type="button" class="btn btn-hacker-success px-4" onclick="sssss()">
                        <i class="fas fa-play"></i> Stop <!--m√†u vang-->
                    </button>
                    <button type="button" class="btn btn-hacker px-4" onclick="aaaaaaa()">
                        <i class="fas fa-save"></i> Save <!--m√†u cam-->
                    </button>
                    <button type="button" class="btn btn-hacker-danger px-4" data-bs-dismiss="modal">
                        <i class="fas fa-times"></i> Close <!--m√†u cam-->
                    </button>
                </div>
            </div>

            <div class="modal-body p-4">
                <!-- Target Selection Info -->
                <div class="target-selection">
                    <i class="fas fa-bullseye me-2"></i>
                    <span class="target-count" id="reconSelectedTargetCount"></span> targets selected for verification
                    <div class="mt-2">
                        <small class="text-muted">
                            <i class="fas fa-info-circle me-1"></i>
                            Check console for detailed target information
                        </small>
                    </div>
                </div>

                <!-- Error Notification -->
                <div class="alert alert-danger mt-3" id="reconErrorAlert" style="display: none;">
                    <i class="fas fa-exclamation-triangle me-2"></i>
                    <span id="reconErrorMessage"></span>
                </div>

                <!-- Success Notification -->
                <div class="alert alert-success mt-3" id="reconSuccessAlert" style="display: none;">
                    <i class="fas fa-check-circle me-2"></i>
                    <span id="reconSuccessMessage"></span>
                </div>

                <!--th√¥ng b√°o v·ªÅ k·∫øt qu·∫£ verify-->
                <div id="reconVerifyResult" class="mt-3"></div>

                <!-- Tool & Mode Selection Section -->
                <div class="my-4 p-3 bg-white rounded shadow-sm">
                    <div class="row align-items-center">
                        <div class="col-md-6 mb-2 mb-md-0">
                            <label class="fw-bold mb-2">Ch·ªçn c√¥ng c·ª•:</label>
                            <div class="d-flex gap-3 flex-wrap" id="reconToolSelectGroup">
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="radio" name="toolSelect" id="toolDirsearch" value="dirsearch" checked onchange="onToolChange()">
                                    <label class="form-check-label" for="toolDirsearch">Dirsearch</label>
                                </div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="radio" name="toolSelect" id="toolWpscan" value="wpscan" onchange="onToolChange()">
                                    <label class="form-check-label" for="toolWpscan">WP-Scan</label>
                                </div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="radio" name="toolSelect" id="toolNmap" value="nmap" onchange="onToolChange()">
                                    <label class="form-check-label" for="toolNmap">Nmap</label>
                                </div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="radio" name="toolSelect" id="toolWappalyzer" value="wappalyzer" onchange="onToolChange()">
                                    <label class="form-check-label" for="toolWappalyzer">Wappalyzer</label>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <label class="fw-bold mb-2">Ch·ªçn mode:</label>
                            <div id="reconModeSelectGroup">
                                <!-- Mode select s·∫Ω thay ƒë·ªïi theo c√¥ng c·ª• -->
                                <select class="form-select" id="reconModeDirsearch">
                                    <option value="fast">Fast</option>
                                    <option value="normal" selected>Normal</option>
                                    <option value="deep">Deep</option>
                                </select>
                                <select class="form-select d-none" id="reconModeWpscan">
                                    <option value="quick">Quick</option>
                                    <option value="full" selected>Full</option>
                                </select>
                                <select class="form-select d-none" id="reconModeNmap">\
                                    <option value="1" selected>Host Discovery</option>
                                    <option value="2">Fast Scan</option>
                                    <option value="3">Service Detection</option>
                                    <option value="4">Vulnerability Scan</option>
                                    <option value="5">Aggressive Scan</option>
                                </select>
                                <select class="form-select d-none" id="reconModeWappalyzer">
                                    <option value="standard" selected>Standard</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Result & Loading Section -->
                <div class="my-4">
                    <div id="reconScanLoading" class="loading-spinner" style="display: none;">
                        <div class="spinner"></div>
                        <p class="mt-2">ƒêang qu√©t, vui l√≤ng ch·ªù...</p>
                    </div>
                    <div id="reconScanResult" class="bg-light p-3 rounded shadow-sm" style="min-height: 120px; font-family: monospace; white-space: pre-wrap;"></div>
                </div>
            </div>
        </div>
    </div>
</div>

<!--V-->
<script>
    // Load POCs when modal opens
    document.addEventListener('DOMContentLoaded', function () {
        const modal = document.getElementById('reconTargetsModal');
        modal.addEventListener('show.bs.modal', function () {
            updateTargetCount();
            displaySelectedTargetsInfo();
        });
    });

    // c·∫≠p nh·∫≠t t·ªïng s·ªë l∆∞·ª£ng
    function updateTargetCount() {
        const checkedTargets = getCheckedTargetIds();
        const count = checkedTargets.length;
        document.getElementById('reconSelectedTargetCount').textContent = count;

        // Hi·ªÉn th·ªã th√™m th√¥ng tin chi ti·∫øt n·∫øu c·∫ßn
        console.log(`Modal: ƒê√£ ch·ªçn ${count} targets:`, checkedTargets);

        // C√≥ th·ªÉ th√™m hi·ªÉn th·ªã danh s√°ch target ƒë√£ ch·ªçn
        if (count > 0) {
            // V√≠ d·ª•: hi·ªÉn th·ªã danh s√°ch target IDs
            const targetList = checkedTargets.join(', ');
            //console.log(`Target IDs: ${targetList}`);
        }
    }

    // Hi·ªÉn th·ªã th√¥ng tin chi ti·∫øt v·ªÅ c√°c target ƒë√£ ch·ªçn
    function displaySelectedTargetsInfo() {
        const targetIds = getCheckedTargetIds();
        const count = targetIds.length;

        // C·∫≠p nh·∫≠t s·ªë l∆∞·ª£ng
        updateTargetCount();

        // Hi·ªÉn th·ªã th√¥ng tin chi ti·∫øt trong console
        console.log('=== TH√îNG TIN TARGETS ƒê√É CH·ªåN ===');
        console.log(`T·ªïng s·ªë: ${count} targets`);
        console.log('Target IDs:', targetIds);

        // N·∫øu c√≥ target ƒë∆∞·ª£c ch·ªçn, hi·ªÉn th·ªã th√™m th√¥ng tin
        if (count > 0) {
        console.log('Danh s√°ch Target IDs:', targetIds.join(', '));

        // C√≥ th·ªÉ th√™m logic ƒë·ªÉ l·∫•y th√¥ng tin chi ti·∫øt c·ªßa t·ª´ng target
        // V√≠ d·ª•: g·ªçi API ƒë·ªÉ l·∫•y th√¥ng tin hostname, IP c·ªßa c√°c target
        fetchTargetDetails(targetIds);
        } else {
        console.log('Ch∆∞a c√≥ target n√†o ƒë∆∞·ª£c ch·ªçn');
        }
  }

    // L·∫•y th√¥ng tin chi ti·∫øt c·ªßa c√°c target (t√πy ch·ªçn)
    function fetchTargetDetails(targetIds) {
        return fetch('/api/getalltarget')
            .then(response => response.json())
            .then(data => {
                if (data.targets) {
                    return data.targets.filter(target =>
                        targetIds.includes(target.server_id.toString())
                    ).map(target => ({
                        id: target.server_id,
                        hostname: target.hostname,
                        ip: target.ip_address
                    }));
                }
                return [];
            });
    }

    // Tool & Mode logic
    function onToolChange() {
        const tool = document.querySelector('input[name="toolSelect"]:checked').value;
        document.getElementById('reconModeDirsearch').classList.add('d-none');
        document.getElementById('reconModeWpscan').classList.add('d-none');
        document.getElementById('reconModeNmap').classList.add('d-none');
        document.getElementById('reconModeWappalyzer').classList.add('d-none');
        if (tool === 'dirsearch') document.getElementById('reconModeDirsearch').classList.remove('d-none');
        if (tool === 'wpscan') document.getElementById('reconModeWpscan').classList.remove('d-none');
        if (tool === 'nmap') document.getElementById('reconModeNmap').classList.remove('d-none');
        if (tool === 'wappalyzer') document.getElementById('reconModeWappalyzer').classList.remove('d-none');
    }

    // Kh·ªüi t·∫°o ƒë√∫ng mode khi load l·∫°i modal
    onToolChange();

    // Scan state
    let scanInProgress = false;

    function startScan() {
        if (scanInProgress) return;
        scanInProgress = true;
        document.getElementById('reconScanLoading').style.display = 'block';
        document.getElementById('reconScanResult').textContent = '';
        const tool = document.querySelector('input[name="toolSelect"]:checked').value;
        let mode = '';
        if (tool === 'dirsearch') mode = document.getElementById('reconModeDirsearch').value;
        if (tool === 'wpscan') mode = document.getElementById('reconModeWpscan').value;
        if (tool === 'nmap') mode = document.getElementById('reconModeNmap').value;
        if (tool === 'wappalyzer') mode = document.getElementById('reconModeWappalyzer').value;
        setTimeout(() => {
            document.getElementById('reconScanLoading').style.display = 'none';
            document.getElementById('reconScanResult').textContent = `K·∫øt qu·∫£ qu√©t v·ªõi tool: ${tool}, mode: ${mode}\n(ƒê√¢y l√† k·∫øt qu·∫£ demo, thay b·∫±ng k·∫øt qu·∫£ th·ª±c t·∫ø)`;
            scanInProgress = false;
        }, 2500);
    }

    function stopScan() {
        scanInProgress = false;
        document.getElementById('reconScanLoading').style.display = 'none';
        document.getElementById('reconScanResult').textContent += '\n[ƒê√£ d·ª´ng qu√©t]';
        //g·ª≠i request v·ªÅ
    }

    function saveScan() {
        // L∆∞u k·∫øt qu·∫£ (t√πy √Ω)
        alert('ƒê√£ l∆∞u k·∫øt qu·∫£ (demo)');
    }

    // G√°n n√∫t
    window.xxxxxx = startScan;
    window.sssss = stopScan;
    window.aaaaaaa = saveScan;
</script>